\section*{Modulo \nombretad{ArbolDeReglas}}

%INTERFAZ
\subsection*{TAD ArbolDeReglas}

\generadores

\alinearfuncs{existeReglaQueCumple}{\hspace{7cm}}
\alinearaxiomas{existeReglaQueCumple(agRegla(a,r),d)}
\textbf{\func{nuevo}{}{ArbolDeReglas}{}}

\textbf{\func{agRegla}{ArbolDeReglas,Regla}{ArbolDeReglas}{}}

\observadores

\textbf{\func{interfazDeSalida}{ArbolDeReglas/a,dirIp/d}{nat}{tieneRegla(a,d)}}
\axioma{interfazDeSalida(agRegla(a,r),d)}{If coincidenEnBits(cantBits(r),dirIp(r),d) then inter(r) else interfazDeSalida(a,d)}

\textbf{\func{tieneRegla}{ArbolDeReglas/a,dirIp/d}{bool}{}}
\axioma{tieneRegla(nuevo(),d)}{false}
\axioma{tieneRegla(agRegla(a,r),d)}{If coincidenEnBits(cantBits(r),dirIp(r),d) then true else tieneRegla(a,d)}

\otrasops

\textbf{\func{altura}{ArbolDeReglas}{nat}{}}
\axioma{altura(nuevo())}{0}
\axioma{altura(agRegla(a,r),d)}{max{cantBits(r),altura(r)}}



%INTERFAZ
\subsection*{Interfaz}
\textbf{interfaz} \textit{Conjunto($\alpha$)}\\
\textbf{se explica con la especificaci\'on de} \textit{Conjunto($\alpha$)}\\
\textbf{usa interfaces} \nombretad{Bool}, \nombretad{Nat}\\
\textbf{genero} \textit{conj($\alpha$)}\\

\textbf{operaciones}\\
$Vacio$()$\longrightarrow res$: conj($\alpha$)\\
$\{$true$\}$\\
$\{\widehat{res} \igobs \phi()\}$\\

$agregar$(in $a$: $\alpha$, inout $C$: conj($\alpha$))\\
$\{\widehat{C}\ \igobs\ C_0\}$\\
$\{\widehat{C}\ \igobs$ Ag($\widehat{a}$,$C_0$)$\}$\\

$pertenece$(in $a$: $\alpha$, in $C$: conj($\alpha$))$\longrightarrow res$: bool\\
$\{$true$\}$\\
$\{\widehat{res}\ \igobs \widehat{a}\in \widehat{C}\}$\\

%REPRESENTACION
\subsection*{Representaci\'on}
\textit{arbolDeReglas} \textbf{se representa con} \textit{puntero(estr)}\\
\textbf{donde} \textit{estr} \textbf{es}\\
\textit{tupla$\langle$ inter: puntero(interfaz) $\times$\\
\hspace*{1.1cm}izq: puntero(estr) $\times$\\
\hspace*{1.1cm}der: puntero(estr) $\rangle$}

%INVARIANTE DE REPRESENTACION
\subsection*{Invariante\ de \ Representaci\'on}
\alinearfuncs{Rep}{\hspace{3cm}}
\textbf{\func{Rep}{puntero(estr)}{boolean}{}}
\vspace{11pt}
($\forall$ p: puntero(estr)) Rep(p) = true $\Leftrightarrow$ no existen ciclos
\vspace{33pt}

%FUNCION DE ABSTRACCION
\subsection*{Funci\'on de Abstracci\'on}

\textbf{\func{Abs}{puntero(estr)/p}{abr}{Rep(p)}}
\vspace{11pt}
($\forall$ p: puntero(estr)) Abs(p) = a: abr/ \\
\\
($\forall$ d: dirIp) (tieneRegla(a,d) $=$ existeRegla(p,pasarABits(d),0) $\yluego$\\
\\
(tieneRegla(a,d) $\impluego$ interfazDeSalida(a,d) = dameSalida(p,pasarABits(d),0,null)))
\vspace{33pt}
\alinearfuncs{existeReglala}{\hspace{11.2cm}}
\alinearaxiomas{dameSalida(p,a,n,pi)}
\textbf{\func{existeRegla}{puntero(estr)/p,arreglo de bool, nat}{bool}{Rep(p)}}
\axioma{existeRegla(p,a,n)}{\lif n $=$ tam(a) $\vee$ e $=$ null \lthen \false\\
			    \hspace*{-0.85cm}\lelse \lif (*p).inter $=$ null \lthen\\
			    \hspace*{1cm}\lif a[n] $=$ \true \lthen existeRegla((*e).der,a,n+1)\\
			    \hspace*{1cm}\lelse existeRegla((*e).izq,a,n+1)\\
			    \hspace*{1cm}\lfi\\
			    \hspace*{-0.85cm}\lelse \true\\
			    \hspace*{-0.85cm}\lfi}

\textbf{\func{dameSalida}{puntero(estr)/p, arreglo de bool/a, nat, puntero(estr)}{interfaz}{Rep(p) $\yluego$ existeRegla(p,a,0)}}
\axioma{dameSalida(p,a,n,pi)}{\lif n $=$ tam(a) $\vee$ p $=$ null \lthen *pi\\
			      \hspace*{-0.85cm}\lelse \lif a[n] $=$ true \lthen\\
			      \hspace*{1cm}\lif pi $\neq$ null \lthen dameSalida((*p).der,a,n+1,pi)\\
			      \hspace*{1cm}\lelse dameSalida((*p).der,a,n+1,(*p).int)\\
			      \hspace*{1cm}\lfi\\
			      \hspace*{-0.85cm}\lelse\\
			      \hspace*{1cm}\lif pi $\neq$ null \lthen dameSalida((*p).izq,a,n+1,pi)\\
			      \hspace*{1cm}\lelse dameSalida((*p).izq,a,n+1,(*p).int)\\
			      \hspace*{1cm}\lfi\\
			      \hspace*{-0.85cm}\lfi}

%ALGORITMOS
\subsection*{Algoritmos}

$iVacio$()$\longrightarrow res$: SecuOrdSinRep($\alpha$)\\
$res\longleftarrow <>$\\

$iagregar$(in $a$: $\alpha$, inout $s$: SecuOrdSinRep($\alpha$)\\
$agregarOdenado(n,s)$\\

$ipertenece$(in $a$: $\alpha$, in $s$: SecuOrdSinRep($\alpha$)\\
$res\longleftarrow esta?(a,s)$\\